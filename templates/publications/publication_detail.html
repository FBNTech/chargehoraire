{% extends 'base.html' %}

{% block content %}
<div class="container-fluid mt-4">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <div class="d-flex justify-content-between align-items-center">
            <h2>Détails de la publication</h2>
            <div>
              {% if publication.fichier %}
              <a href="{{ publication.fichier.url }}" class="btn btn-info me-2" target="_blank">
                <i class="fas fa-file-download"></i> Télécharger
              </a>
              {% endif %}
              {% if publication.url %}
              <a href="{{ publication.url }}" class="btn btn-secondary me-2" target="_blank">
                <i class="fas fa-external-link-alt"></i> Lien externe
              </a>
              {% endif %}
              <a href="{% url 'publications:publication_edit' publication.id %}" class="btn btn-warning me-2">
                <i class="fas fa-edit"></i> Modifier
              </a>
              <button class="btn btn-danger" onclick="confirmDelete()">
                <i class="fas fa-trash"></i> Supprimer
              </button>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div class="row mb-4">
            <div class="col-md-8">
              <h3 class="mb-3">{{ publication.titre }}</h3>
              <p class="text-muted">
                <span class="badge {% if publication.type == 'article' %}bg-info{% elif publication.type == 'livre' %}bg-success{% elif publication.type in 'these,memoire' %}bg-danger{% elif publication.type == 'communication' %}bg-warning{% else %}bg-secondary{% endif %}">
                  {{ publication.get_type_display }}
                </span>
              </p>
            </div>
            <div class="col-md-4 text-md-end">
              <p class="mb-1"><strong>Date de publication:</strong> {{ publication.date_publication|date:"d/m/Y" }}</p>
              <p><strong>Département:</strong> {% if publication.departement %}{{ publication.departement }}{% else %}Non spécifié{% endif %}</p>
            </div>
          </div>

          <div class="row mb-4">
            <!-- Informations de base -->
            <div class="col-md-6">
              <div class="card mb-3">
                <div class="card-header">
                  <h5 class="mb-0">Auteurs</h5>
                </div>
                <div class="card-body">
                  <ul class="list-group list-group-flush">
                    {% for auteur in publication.auteurs.all %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                      <div>
                        {{ auteur.nom_complet }}
                        {% if auteur.departement %}
                        <small class="text-muted d-block">{{ auteur.departement }}</small>
                        {% endif %}
                      </div>
                      <a href="{% url 'publications:teacher_publications' auteur.id %}" class="btn btn-sm btn-outline-primary">
                        Voir publications
                      </a>
                    </li>
                    {% empty %}
                    <li class="list-group-item">Aucun auteur spécifié</li>
                    {% endfor %}
                  </ul>
                </div>
              </div>
            </div>
            
            <!-- Détails spécifiques selon le type de publication -->
            <div class="col-md-6">
              <div class="card">
                <div class="card-header">
                  <h5 class="mb-0">Détails {% if publication.type == 'article' %}de l'article{% elif publication.type == 'livre' %}du livre{% elif publication.type in 'these,memoire' %}de la thèse/mémoire{% elif publication.type == 'communication' %}de la communication{% else %}de la publication{% endif %}</h5>
                </div>
                <div class="card-body">
                  <dl class="row mb-0">
                    {% if publication.type == 'article' and specific_publication %}
                      <dt class="col-sm-4">Journal</dt>
                      <dd class="col-sm-8">{{ specific_publication.journal }}</dd>
                      
                      {% if specific_publication.volume %}
                      <dt class="col-sm-4">Volume</dt>
                      <dd class="col-sm-8">{{ specific_publication.volume }}</dd>
                      {% endif %}
                      
                      {% if specific_publication.numero %}
                      <dt class="col-sm-4">Numéro</dt>
                      <dd class="col-sm-8">{{ specific_publication.numero }}</dd>
                      {% endif %}
                      
                      {% if specific_publication.pages %}
                      <dt class="col-sm-4">Pages</dt>
                      <dd class="col-sm-8">{{ specific_publication.pages }}</dd>
                      {% endif %}
                      
                      {% if specific_publication.impact_factor %}
                      <dt class="col-sm-4">Facteur d'impact</dt>
                      <dd class="col-sm-8">{{ specific_publication.impact_factor }}</dd>
                      {% endif %}
                      
                      <dt class="col-sm-4">À comité de lecture</dt>
                      <dd class="col-sm-8">{% if specific_publication.peer_reviewed %}Oui{% else %}Non{% endif %}</dd>
                      
                      {% if specific_publication.doi %}
                      <dt class="col-sm-4">DOI</dt>
                      <dd class="col-sm-8">
                        <a href="https://doi.org/{{ specific_publication.doi }}" target="_blank">
                          {{ specific_publication.doi }}
                        </a>
                      </dd>
                      {% endif %}
                      
                    {% elif publication.type == 'livre' and specific_publication %}
                      <dt class="col-sm-4">Éditeur</dt>
                      <dd class="col-sm-8">{{ specific_publication.editeur }}</dd>
                      
                      {% if specific_publication.lieu_publication %}
                      <dt class="col-sm-4">Lieu de publication</dt>
                      <dd class="col-sm-8">{{ specific_publication.lieu_publication }}</dd>
                      {% endif %}
                      
                      {% if specific_publication.isbn %}
                      <dt class="col-sm-4">ISBN</dt>
                      <dd class="col-sm-8">{{ specific_publication.isbn }}</dd>
                      {% endif %}
                      
                      {% if specific_publication.nombre_pages %}
                      <dt class="col-sm-4">Nombre de pages</dt>
                      <dd class="col-sm-8">{{ specific_publication.nombre_pages }}</dd>
                      {% endif %}
                      
                      {% if specific_publication.edition %}
                      <dt class="col-sm-4">Édition</dt>
                      <dd class="col-sm-8">{{ specific_publication.edition }}</dd>
                      {% endif %}
                      
                    {% elif publication.type in 'these,memoire' and specific_publication %}
                      <dt class="col-sm-4">Niveau</dt>
                      <dd class="col-sm-8">{{ specific_publication.get_niveau_display }}</dd>
                      
                      <dt class="col-sm-4">Université</dt>
                      <dd class="col-sm-8">{{ specific_publication.universite }}</dd>
                      
                      {% if specific_publication.directeur %}
                      <dt class="col-sm-4">Directeur de thèse</dt>
                      <dd class="col-sm-8">{{ specific_publication.directeur }}</dd>
                      {% endif %}
                      
                      {% if specific_publication.nombre_pages %}
                      <dt class="col-sm-4">Nombre de pages</dt>
                      <dd class="col-sm-8">{{ specific_publication.nombre_pages }}</dd>
                      {% endif %}
                      
                      {% if specific_publication.mention %}
                      <dt class="col-sm-4">Mention</dt>
                      <dd class="col-sm-8">{{ specific_publication.mention }}</dd>
                      {% endif %}
                      
                    {% elif publication.type == 'communication' and specific_publication %}
                      <dt class="col-sm-4">Conférence</dt>
                      <dd class="col-sm-8">{{ specific_publication.nom_conference }}</dd>
                      
                      {% if specific_publication.lieu %}
                      <dt class="col-sm-4">Lieu</dt>
                      <dd class="col-sm-8">{{ specific_publication.lieu }}</dd>
                      {% endif %}
                      
                      <dt class="col-sm-4">Date de début</dt>
                      <dd class="col-sm-8">{{ specific_publication.date_debut|date:"d/m/Y" }}</dd>
                      
                      {% if specific_publication.date_fin %}
                      <dt class="col-sm-4">Date de fin</dt>
                      <dd class="col-sm-8">{{ specific_publication.date_fin|date:"d/m/Y" }}</dd>
                      {% endif %}
                      
                      <dt class="col-sm-4">Publié dans les actes</dt>
                      <dd class="col-sm-8">{% if specific_publication.publie_dans_actes %}Oui{% else %}Non{% endif %}</dd>
                      
                      {% if specific_publication.presentation_type %}
                      <dt class="col-sm-4">Type de présentation</dt>
                      <dd class="col-sm-8">{{ specific_publication.presentation_type }}</dd>
                      {% endif %}
                    {% else %}
                      <p>Informations détaillées non disponibles pour ce type de publication.</p>
                    {% endif %}
                  </dl>
                </div>
              </div>
            </div>
          </div>

          <!-- Résumé/Description -->
          <div class="card mb-4">
            <div class="card-header">
              <h5 class="mb-0">Description</h5>
            </div>
            <div class="card-body">
              {% if publication.description %}
                {{ publication.description|linebreaks }}
              {% else %}
                <em>Aucune description fournie.</em>
              {% endif %}
            </div>
          </div>

          <!-- Métadonnées -->
          <div class="card mb-4">
            <div class="card-header">
              <h5 class="mb-0">Métadonnées</h5>
            </div>
            <div class="card-body">
              <dl class="row mb-0">
                <dt class="col-sm-3">Date de création</dt>
                <dd class="col-sm-9">{{ publication.date_creation|date:"d/m/Y H:i" }}</dd>
                
                <dt class="col-sm-3">Dernière modification</dt>
                <dd class="col-sm-9">{{ publication.date_modification|date:"d/m/Y H:i" }}</dd>
                
                {% if publication.mots_cles %}
                <dt class="col-sm-3">Mots clés</dt>
                <dd class="col-sm-9">
                  {% for mot in publication.mots_cles.split %}
                    <span class="badge bg-secondary me-1">{{ mot }}</span>
                  {% endfor %}
                </dd>
                {% endif %}
              </dl>
            </div>
          </div>

          <div class="mt-3">
            <a href="{% url 'publications:publication_list' %}" class="btn btn-secondary">
              <i class="fas fa-arrow-left"></i> Retour à la liste
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function confirmDelete() {
    if (confirm('Êtes-vous sûr de vouloir supprimer cette publication ?')) {
      window.location.href = "{% url 'publications:publication_delete' publication.id %}";
    }
  }
</script>
{% endblock %}
